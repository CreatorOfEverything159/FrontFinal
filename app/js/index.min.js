let elem,cards,data,globalIndex=0;const getFocusIndex=()=>+elem.getAttribute("tabindex"),showTextarea=()=>{document.querySelectorAll(`[data-inputId="${globalIndex}"]`)[0].style.display="block",document.querySelectorAll(`[data-textareaId="${globalIndex}"]`)[0].focus()},getData=e=>new Promise(((a,t)=>{let n=new XMLHttpRequest;n.open("GET",e),n.onload=()=>{200===n.status?a(JSON.parse(n.response)):t(Error(`Error: ${n.statusText}`))},n.send()})),includeData=e=>{getData(e).then((e=>{console.log(e);let a=document.getElementById("cardSet");a.innerHTML="",a.innerHTML+=e.map(((e,a)=>createCard(e,a+1))).join(""),cards=document.getElementsByClassName("card"),cards[globalIndex].focus()}))},dispatcher=e=>{if(e.shiftKey&&"Enter".includes(e.key))"TEXTAREA"===document.activeElement.tagName||(e.preventDefault(),elem.classList.remove("cardDecline"),elem.classList.remove("cardApprove"),elem.classList.add("cardEscalate"),globalIndex=getFocusIndex(),showTextarea());else if(e.shiftKey&&"Tab".includes(e.key))e.preventDefault(),globalIndex=getFocusIndex()-2,cards[globalIndex%cards.length].focus();else if("Tab"===e.code)e.preventDefault(),globalIndex=getFocusIndex(),cards[globalIndex%cards.length].focus();else if("Enter"===e.code)"TEXTAREA"===document.activeElement.tagName&&(e.preventDefault(),cards[globalIndex%cards.length].focus());else if("Space"===e.code)"TEXTAREA"!==document.activeElement.tagName&&(e.preventDefault(),elem.classList.remove("cardEscalate"),elem.classList.remove("cardDecline"),elem.classList.add("cardApprove"),elem.lastElementChild.style.display="none",globalIndex=getFocusIndex(),cards[globalIndex%cards.length].focus());else if("Delete"===e.code)"TEXTAREA"!==document.activeElement.tagName&&(e.preventDefault(),elem.classList.remove("cardEscalate"),elem.classList.remove("cardApprove"),elem.classList.add("cardDecline"),globalIndex=getFocusIndex(),showTextarea());else if("F7"===e.code){e.preventDefault();let a=document.getElementsByClassName("card");for(let e=0;e<a.length;e++)if(a[e].classList.length<2)return alert("Not all ads processed!"),void a[e].focus();renderPage()}},createCard=(e,a)=>{let{id:t,publishDateString:n,ownerLogin:s,bulletinSubject:l,bulletinText:d,bulletinImages:c}=e;return`<div class="card" tabindex="${a}">\n                <div class="card__header">\n                    <div class="card__header_left">\n                        <a target="_blank" href="" class="adId">${t}</a> â€” <span class="time">${n}</span>\n                    </div>\n                    <div class="card__header_right">\n                        <a target="_blank" href="" class="user">\n                            <img class="userIcon" alt="" src="./img/vector.svg">\n                            <span class="userName">${s}</span>\n                        </a>\n                    </div>\n                </div>\n                <h2 class="card__title">${l}</h2>\n                <div class="card__content">\n                    <div class="card__content_text">\n                        <p class="text">${d}</p>\n                    </div>\n                    <div class="card__content_images">\n                        ${c.map((e=>`<img src="data:image/jpeg;base64,${e}" alt="" width="300px"><br>`)).join("")}\n                    </div>\n                </div>\n                <div class="card__comment" data-inputId="${a}">\n                    <h3 class="card__comment_title">Comment</h3>\n                    <textarea data-textareaId="${a}" name="" class="comment"></textarea>\n                </div>\n            </div>`},renderPage=()=>{document.getElementById("cardSet").innerHTML="",getData("http://localhost:4200/data").then((e=>{console.log(e);let a=document.getElementById("cardSet");a.innerHTML="",a.innerHTML+=e.map(((e,a)=>createCard(e,a+1))).join(""),cards=document.getElementsByClassName("card"),cards[globalIndex].focus()})),document.addEventListener("focusin",(function(e){elem=e.target})),globalIndex=0},initPage=e=>{if("Enter"===e.code){document.getElementById("init").style.display="none",document.getElementsByClassName("main")[0].classList.remove("invisible"),renderPage(),document.removeEventListener("keydown",initPage),document.addEventListener("keydown",dispatcher)}};document.addEventListener("keydown",initPage);